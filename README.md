# recsys_MADE

Пакет содержит 2 точки входа: db, api
Для установки подуля и зависимостей выполнить:

```pip install .```

Для миграции на свою базу данных следует выполнить:

```recsy-db upgrade head```

Если нужны партиции (Артиклей по году), следует выполнить

```architect partition --module db.models```

! После выполнения партиционирования для текущих данных ничего не поменяется, но при загрузке новых будут создаваться отдельные таблицы в соответсвии с настроенными разбиениями.

! Выполнение команды ```recsys-db downgrade -1``` для удаления после разбиения невозможно, поскольку скрипт миграции ничего не знает про партиции. Поскольку таблицы `articles` и `articles_{year}_{year}` связаны, удаление основной таблицы возможно только после удаления всех партиций. Это сможно сделать или вручную (скриптом), или изменив соответсвующим образом сгенерированный скрипт миграции.

! Партиции `architect` не поддерживаются если в таблице есть `fk`. Точнее партиции создадутся без проблема, но при загрзке детей тригер не сможет найти соответсвующего родителя. Следует выключить все тригеры на таблицах, которые ссылаются на `articles` и будут загружены после
```
ALTER TABLE article_author DISABLE TRIGGER ALL
ALTER TABLE articles DISABLE TRIGGER ALL
ALTER TABLE art_references DISABLE TRIGGER ALL
ALTER TABLE article_tags DISABLE TRIGGER ALL
```

Для запуска сервиса (ниже используются значения по умолчанию):

```recsys-api --host 0.0.0.0 --port 80```



## Далее информация для команды, работающей на проектом

Для установки модуля в виртуальное окружение следует создать и запустить виртульное окружение и выполнить команду:
```pip install -e .[dev, tests]```

Это нужно для того, чтобы ваш модуль появился в установленных модулях ```pip```. Так честно удобнее работать. 

Если надо добавить какую-то библиотеку в ```requirements``` следует изменить файл ```setup.py``` добавив в ```install_requires=[]``` нужные библиотеки. После чего выпольнить команду установки пакета (см. выше) снова.

Файл ```setup.cfg``` задаёт параметры для различных модулей:
- Раздел ```mypy``` правила проверки для соответсвующей библиотеки
- Раздл ```flake8``` правила проверки кода на соответсвия ```pep8```. Если какое-то правило ненужно, можно прописать отдельно. Пример: D104 - это обязательная док строка в начале файлов. Она отключена для тестов и ```__init__.py```
- Раздел ```pytest``` помогает соответсвующей библиотеке искать нужные тесты. 